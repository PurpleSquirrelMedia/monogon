Copyright 2020 The Monogon Project Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.


From d92dc4195d4de5149e7e55890fa856837a35217e Mon Sep 17 00:00:00 2001
From: Lorenz Brun <lorenz@brun.one>
Date: Mon, 4 May 2020 15:33:40 +0200
Subject: [PATCH] Reflect code patches in Bazel

---
 cmd/containerd-shim-runsc-v1/BUILD.bazel |  1 +
 cmd/gvisor-containerd-shim/BUILD.bazel   |  4 ++--
 pkg/v1/proc/BUILD.bazel                  |  3 ++-
 pkg/v1/shim/BUILD.bazel                  |  5 +++--
 pkg/v2/BUILD.bazel                       | 14 ++++++++------
 5 files changed, 16 insertions(+), 11 deletions(-)

diff --git a/cmd/gvisor-containerd-shim/BUILD.bazel b/cmd/gvisor-containerd-shim/BUILD.bazel
index 8478746..f6a6fa2 100644
--- a/cmd/gvisor-containerd-shim/BUILD.bazel
+++ b/cmd/gvisor-containerd-shim/BUILD.bazel
@@ -14,9 +14,9 @@ go_library(
         "@com_github_burntsushi_toml//:go_default_library",
         "@com_github_containerd_containerd//events:go_default_library",
         "@com_github_containerd_containerd//namespaces:go_default_library",
-        "@com_github_containerd_containerd//runtime/v1/linux/proc:go_default_library",
-        "@com_github_containerd_containerd//runtime/v1/shim:go_default_library",
+        "@com_github_containerd_containerd//pkg/process:go_default_library",
         "@com_github_containerd_containerd//runtime/v1/shim/v1:go_default_library",
+        "@com_github_containerd_containerd//sys/reaper:go_default_library",
         "@com_github_containerd_ttrpc//:go_default_library",
         "@com_github_containerd_typeurl//:go_default_library",
         "@com_github_gogo_protobuf//types:go_default_library",
diff --git a/pkg/v1/proc/BUILD.bazel b/pkg/v1/proc/BUILD.bazel
index 8ef457c..1bf9228 100644
--- a/pkg/v1/proc/BUILD.bazel
+++ b/pkg/v1/proc/BUILD.bazel
@@ -21,7 +21,8 @@ go_library(
         "@com_github_containerd_containerd//errdefs:go_default_library",
         "@com_github_containerd_containerd//log:go_default_library",
         "@com_github_containerd_containerd//mount:go_default_library",
-        "@com_github_containerd_containerd//runtime/proc:go_default_library",
+        "@com_github_containerd_containerd//pkg/process:go_default_library",
+        "@com_github_containerd_containerd//pkg/stdio:go_default_library",
         "@com_github_containerd_fifo//:go_default_library",
         "@com_github_containerd_go_runc//:go_default_library",
         "@com_github_gogo_protobuf//types:go_default_library",
diff --git a/pkg/v1/shim/BUILD.bazel b/pkg/v1/shim/BUILD.bazel
index a5d83c4..2129cd8 100644
--- a/pkg/v1/shim/BUILD.bazel
+++ b/pkg/v1/shim/BUILD.bazel
@@ -20,11 +20,12 @@ go_library(
         "@com_github_containerd_containerd//log:go_default_library",
         "@com_github_containerd_containerd//mount:go_default_library",
         "@com_github_containerd_containerd//namespaces:go_default_library",
+        "@com_github_containerd_containerd//pkg/process:go_default_library",
+        "@com_github_containerd_containerd//pkg/stdio:go_default_library",
         "@com_github_containerd_containerd//runtime:go_default_library",
         "@com_github_containerd_containerd//runtime/linux/runctypes:go_default_library",
-        "@com_github_containerd_containerd//runtime/proc:go_default_library",
-        "@com_github_containerd_containerd//runtime/v1/shim:go_default_library",
         "@com_github_containerd_containerd//runtime/v1/shim/v1:go_default_library",
+        "@com_github_containerd_containerd//sys/reaper:go_default_library",
         "@com_github_containerd_fifo//:go_default_library",
         "@com_github_containerd_typeurl//:go_default_library",
         "@com_github_gogo_protobuf//types:go_default_library",
diff --git a/pkg/v2/BUILD.bazel b/pkg/v2/BUILD.bazel
index a7a6abb..d61b785 100644
--- a/pkg/v2/BUILD.bazel
+++ b/pkg/v2/BUILD.bazel
@@ -16,20 +16,21 @@ go_library(
             "//pkg/v1/utils:go_default_library",
             "//pkg/v2/options:go_default_library",
             "@com_github_burntsushi_toml//:go_default_library",
-            "@com_github_containerd_cgroups//:go_default_library",
+            "@com_github_containerd_cgroups//stats/v1:go_default_library",
             "@com_github_containerd_console//:go_default_library",
             "@com_github_containerd_containerd//api/events:go_default_library",
             "@com_github_containerd_containerd//api/types/task:go_default_library",
             "@com_github_containerd_containerd//errdefs:go_default_library",
-            "@com_github_containerd_containerd//events:go_default_library",
             "@com_github_containerd_containerd//log:go_default_library",
             "@com_github_containerd_containerd//mount:go_default_library",
             "@com_github_containerd_containerd//namespaces:go_default_library",
+            "@com_github_containerd_containerd//pkg/process:go_default_library",
+            "@com_github_containerd_containerd//pkg/stdio:go_default_library",
             "@com_github_containerd_containerd//runtime:go_default_library",
             "@com_github_containerd_containerd//runtime/linux/runctypes:go_default_library",
-            "@com_github_containerd_containerd//runtime/proc:go_default_library",
             "@com_github_containerd_containerd//runtime/v2/shim:go_default_library",
             "@com_github_containerd_containerd//runtime/v2/task:go_default_library",
+            "@com_github_containerd_containerd//sys/reaper:go_default_library",
             "@com_github_containerd_cri//pkg/api/runtimeoptions/v1:go_default_library",
             "@com_github_containerd_fifo//:go_default_library",
             "@com_github_containerd_typeurl//:go_default_library",
@@ -44,20 +45,21 @@ go_library(
             "//pkg/v1/utils:go_default_library",
             "//pkg/v2/options:go_default_library",
             "@com_github_burntsushi_toml//:go_default_library",
-            "@com_github_containerd_cgroups//:go_default_library",
+            "@com_github_containerd_cgroups//stats/v1:go_default_library",
             "@com_github_containerd_console//:go_default_library",
             "@com_github_containerd_containerd//api/events:go_default_library",
             "@com_github_containerd_containerd//api/types/task:go_default_library",
             "@com_github_containerd_containerd//errdefs:go_default_library",
-            "@com_github_containerd_containerd//events:go_default_library",
             "@com_github_containerd_containerd//log:go_default_library",
             "@com_github_containerd_containerd//mount:go_default_library",
             "@com_github_containerd_containerd//namespaces:go_default_library",
+            "@com_github_containerd_containerd//pkg/process:go_default_library",
+            "@com_github_containerd_containerd//pkg/stdio:go_default_library",
             "@com_github_containerd_containerd//runtime:go_default_library",
             "@com_github_containerd_containerd//runtime/linux/runctypes:go_default_library",
-            "@com_github_containerd_containerd//runtime/proc:go_default_library",
             "@com_github_containerd_containerd//runtime/v2/shim:go_default_library",
             "@com_github_containerd_containerd//runtime/v2/task:go_default_library",
+            "@com_github_containerd_containerd//sys/reaper:go_default_library",
             "@com_github_containerd_cri//pkg/api/runtimeoptions/v1:go_default_library",
             "@com_github_containerd_fifo//:go_default_library",
             "@com_github_containerd_typeurl//:go_default_library",
-- 
2.25.1

